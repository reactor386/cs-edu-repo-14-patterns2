//-
using System;
using System.Collections.Generic;

using YoutubeExplodeExploiter.Commands;


namespace YoutubeExplodeExploiter.App;

internal class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("YoutubeExplodeExploiter");
        Console.WriteLine("---");
        int result = 0;

        Console.WriteLine("Введите адрес видео: ");
        string videoUrl = Console.ReadLine() ?? string.Empty;

        Console.WriteLine("Введите путь файла вывода: ");
        string outputFilePath = Console.ReadLine() ?? string.Empty;

        CommandManager commandManager = new(videoUrl);
        YoutubeOperator youtubeOperator = new();

        CommandGetVideoInfo getInfoCommand = new(youtubeOperator);
        commandManager.SetCommand(getInfoCommand);
        commandManager.Run();
        Dictionary<string, string> videoInfo = getInfoCommand.VideoInfo;

        if (videoInfo.Keys.Count > 0)
        {
            Console.WriteLine("---");
            Console.WriteLine("Информация о видео: ");
            foreach (string key in videoInfo.Keys)
            {
                Console.WriteLine($"{key}: {videoInfo[key]}");
            }
        }
        else
        {
            Console.WriteLine("Запрос информации завершился ошибкой");
        }

        CommandGetVideoContent getContentCommand = new(youtubeOperator, outputFilePath);
        commandManager.SetCommand(getContentCommand);
        commandManager.Run();
        bool contentSuccess = getContentCommand.ContentSuccess;

        if (contentSuccess)
        {
            Console.WriteLine("---");
            Console.WriteLine($"Получен файл: {outputFilePath}");
        }
        else
        {
            Console.WriteLine("Скачивание файла завершилось ошибкой");
        }

        Console.WriteLine("---");
        Console.WriteLine($"return: [{result}]");
        Console.ReadKey();
    }
}
